/*! Delving Instant - v1.7.1 - 2019-12-03
* https://github.com/delving/delving-instant
* Copyright (c) 2019 Delving B.V. info@delving.eu; Licensed MIT */

String.prototype.trunc=function(e,t){var a,i=this.length>e;if(i)return a=i?this.substr(0,e-1):this,a=t&&i?a.substr(0,a.lastIndexOf(" ")):a,i?a+"&hellip;":a},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return t=!t||t<0?0:+t,this.substring(t,t+e.length)===e}}),function(e){e.DelvingInstant=function(t,a){var l=this;l.$el=e(t),l.el=t,l.$el.data("DelvingInstant",l),e("body").append('<input type="hidden" name="diw-state" id="diw-state" value=""/>'),l.setStatus=function(t){e("#diw-state").attr("value",t).trigger("change")},l.getStatus=function(){return e("#diw-state").attr("value")},l.osviewer=null,l.lastImageViewed=null,l.endPointPath=null,l.apiEndPoint=null,l.init=function(){for(l.setStatus("DIW_INIT"),l.options=e.extend(!0,e.DelvingInstant.defaultOptions,a),l.options.endPointPath&&l.options.endPointPath.trim().length&&l.options.endPointPath.indexOf("/vc/")>-1||l.options.endPointPath.indexOf("/vw/")>-1?(l.endPointPath=l.options.endPointPath.trim(),l.options.collectionSpecs=[]):l.endPointPath="/api/search/v1/",l.version="1.7.1",!0===l.options.useSimpleSearch&&l.showSearchForm(),!0===l.options.useAdvancedSearch&&l.showAdvancedSearchForm(),!0===l.options.useGeoSearch&&l.showGeoSearchForm(),l.dataProviders="",l.dataOwner="",i=0,i=0;i<l.options.dataProviders.length;i++)l.dataProviders+="&hqf[]=delving_owner_facet:"+encodeURIComponent(a.dataProviders[i]),l.dataOwner+="&dataowner="+encodeURIComponent(a.dataProviders[i]);for(l.collectionSpecs="",i=0;i<l.options.collectionSpecs.length;i++)l.collectionSpecs+="&hqf[]=delving_spec:"+encodeURIComponent(a.collectionSpecs[i]);for(l.customFacetFields="",i=0;i<l.options.customFacets.length;i++)l.customFacetFields+="&facet.field="+encodeURIComponent(l.options.customFacets[i]);if(l.pId="",e.url().param(l.options.pageId)&&(l.pId="&"+l.options.pageId+"="+e.url().param(l.options.pageId)),l.pageNrParameter="page",l.options.pageNrParameter.trim().length>0&&(l.pageNrParameter=l.options.pageNrParameter),l.searchIn="",l.options.searchIn.length>0&&(l.searchIn="&searchIn="+l.options.searchIn),l.options.configHelp){var t,o,s,n,r,d,c,u,p=!1;e("body").append('<div id="diw-config-help" class="movable"><h4 class="header">DIW configuration help <small>Click and drag me to re-position</small></h4><p>You have configuration help turned on. Please make sure to set this to "false" for production mode</p><hr/><a class="btn" data-toggle="dropdown" href="#" id="show-help">Show me the good stuff!</a><section id="diw-config-feedback"><div id="errors"></div><div id="resultsJson"></div><div id="resultFields"></div><div id="availableFacets"></div><div id="itemJson"></div><div id="itemFields"></div></section></div>'),e("#diw-config-help .header").on("mousedown",function(e){p=!0,t=e.pageX,o=e.pageY}),e("#diw-config-help").on("mouseup",function(){p=!1}),e("#diw-config-help").on("mouseleave",function(){p=!1}),e("#diw-config-help").on("mousemove",function(a){p&&(s=a.pageX-t,n=a.pageY-o,r=e("#diw-config-help").position().left,d=e("#diw-config-help").position().top,c=s+r,u=n+d,e("#diw-config-help").css({left:c,top:u}),t=a.pageX,o=a.pageY)}),e("#diw-config-help #show-help").on("click",function(){e(this).toggleClass("open").siblings("section").slideToggle("slow")})}},l.changeState=function(t){l.options.configHelp&&e("#diw-config-help #diw-config-feedback > div").html(""),window.history&&window.history.pushState&&l.options.usePushState?History.pushState(null,null,t):document.location.href=t},l.magicLinks=function(){var t=new RegExp(l.options.itemId,"g");e(".diw-link").each(function(){var a,i;if((a=e(this).attr("href")?e(this).attr("href"):e(this).attr("data-href")).match(t))i=decodeURIComponent(a)+l.pId;else{try{i=decodeURIComponent(a)}catch(e){i=a}e(this).attr("href")?e(this).attr("href",i):e(this).attr("data-href",i)}e(this).on("click",function(e){e.preventDefault(),l.changeState(i)})})},l.checkImages=function(){e(".diw-img").on("error",function(){var e=jQuery(this);l.showDefaultImg(e)}),e(".diw-img").each(function(){0===e(this).attr("src").trim().length&&l.showDefaultImg(e(this))})},l.showDefaultImg=function(t){var a=new Image;a.src=l.options.defaultImg,a.onload=function(){e(t).attr("src",l.options.defaultImg)}},l.ajaxRequest=function(t,a,i,l){e.ajax({type:"GET",url:t,dataType:"jsonp",success:function(e){a(e)},error:function(e){console.log("DIW Error: ",e),i&&i()},complete:function(){l&&l()}})},l.showSearchForm=function(){var t="";t='<form action="" method="get" id="diw-search-form" class="form-inline">',t+='<input type="text" name="query" id="diw-query-term" class="form-control" value="" placeholder="'+l.options.label.searchInputPlaceholder+'" />',t+='<button type="submit" id="diw-query-submit" class="btn btn-default diw-button">'+l.options.label.search+"</button>",!0===l.options.useAdvancedSearch&&(t+='<div class="diw-as-toggle-container"><a href="#" id="diw-as-toggle">'+l.options.label.advancedSearch+"</a></div>"),!0===l.options.useGeoSearch&&(t+='<a href="#" id="diw-geo-toggle"><img src="images/map.svg" alt="search with map" width="32"/></a>'),t+="</form>",e(l.options.layout.simpleSearchBlock).html(t),e("#diw-query-term").focus(),e("#diw-search-form").submit(function(){var t=e("#diw-query-term"),a=t.val(),i=e("#diw-search-in").val();return i&&i.length&&(a=i+":"+t.val()),t.val().length>0?l.changeState(decodeURIComponent("?query="+a)):l.changeState(decodeURIComponent("?query=*:*")),!1===l.options.usePushState&&t.val(a),!1})},l.showAdvancedSearchForm=function(){var t=l.options.layout.advancedSearchBlock,a="";if(e(t).hide(),!0===l.options.useAdvancedSearch){l.options.advancedSearchFields&&l.options.advancedSearchFields.length?(a+='<select name="field" class="searchfield form-control">',e(l.options.advancedSearchFields).each(function(e,t){a+='<option value="'+t.name+'">'+t.label+"</option>"})):a+='<select name="field" class="searchfield form-control"><option value="">Any field</option><option value="dc_title_text">Titel</option><option value="dc_creator_text">Vervaardiger</option><option value="dc_date_text">Periode</option>',a+="</select>";var i='<div class="diw-advanced-search-container"><form method="get" action="#" id="diw-advanced-search-form" class="form"><div class="diw-as-row form-group"><select name="bool" class="input-small form-control"><option value="AND">'+l.options.label.boolAnd+'</option><option value="OR">'+l.options.label.boolOr+'</option><option value="NOT">'+l.options.label.boolNot+"</option></select>"+a+'<input type="text" name="query" class="form-control" value="" placeholder="'+l.options.label.searchInputPlaceholder+'"/></div><div class="btn-toolbar"><div class="btn-group"><button id="diw-as-remove-row" class="btn btn-default">-</button><button id="diw-as-add-row" class="btn btn-default">+</button></div><div class="btn-group"><input type="submit" value="'+l.options.label.search+'" class="btn diw-button"/></div></div></form></div>';e(i).appendTo(l.options.layout.advancedSearchBlock),e("#diw-as-toggle").on("click",function(a){a.preventDefault();var i=document.querySelector("#diw-geo-toggle");e(t).toggle("medium",function(){e(t).is(":visible")?(e("#diw-search-form input#diw-query-term, #diw-search-form #diw-query-submit").prop("disabled",!0),i&&i.setAttribute("disabled",!0),e("#diw-as-toggle").text(l.options.label.advancedSearchClose)):(e("#diw-search-form input#diw-query-term, #diw-search-form #diw-query-submit, #diw-geo-toggle").prop("disabled",!1),i&&i.removeAttribute("disabled"),e("#diw-as-toggle").text(l.options.label.advancedSearch))})});var o=e("#diw-as-add-row"),s=e("#diw-as-remove-row"),n=0,r=e(".diw-as-row").clone();o.click(function(t){t.preventDefault(),n<3?(n++,r.clone().insertBefore(e(".btn-toolbar")),s.show()):o.hide()}),s.click(function(t){t.preventDefault(),n>0&&e(this).closest("div.btn-toolbar").prev(".diw-as-row").remove(),0===--n&&(s.hide(),o.show())}),e('select[name="bool"]').first().remove(),e("form#diw-advanced-search-form").on("submit",function(t){t.preventDefault();var a="";e("select.searchfield").each(function(t){var i,l="",o="";(l=e(this).val().trim()).length>0&&(l+=":"),t>0&&(o=" "+e(this).prev('select[name="bool"]').find(":selected").val()+" "),(i=e(this).next('input[type="text"]').val()).length>0&&(a+=o+l+i)}),l.changeState("?query="+a)})}},l.showGeoSearchForm=function(){var e=document.querySelector("#diw-geo-toggle"),t=document.querySelector("#diw-geo-search"),a=['<div id="diw-geo-map" style="width: 100%; height: 400px;"></div>','<form method="get" action="" id="geo-search-form">','<div class="form-group">','<div class="input-group">','<input class="form-control" placeholder="Zoekterm" type="text" name="q" id="geo-q" value="">','<span class="input-group-btn">','<button type="submit" class="btn btn-default">',l.options.label.search,"</button>","</span>","</div>","</div>",'<input type="hidden" name="max_x" id="max_x"/>','<input type="hidden" name="max_y" id="max_y"/>','<input type="hidden" name="min_x" id="min_x"/>','<input type="hidden" name="min_y" id="min_y"/>','<input type="hidden" name="map_zoom_level" id="map_zoom_level"/>',"</form>"];t.innerHTML=a.join("");var i=document.querySelector("#geo-search-form"),o=document.querySelector("#max_x"),s=document.querySelector("#max_y"),n=document.querySelector("#min_x"),r=document.querySelector("#min_y"),d=(document.querySelector("#map_zoom_level"),L.map("diw-geo-map",{center:[52.1326,5.2913],zoom:7,minZoom:2}));L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(d);var c=new L.FeatureGroup;d.addLayer(c);var u={draw:{rectangle:{drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!"},shapeOptions:{color:"#97009c"},tooltip:{start:"Hello"}},polygon:!1,polyline:!1,circle:!1,marker:!1,circlemarker:!1},edit:{featureGroup:c,edit:!1,remove:!0},handlers:{rectangle:{tooltip:{start:"Hello"}}}},p=function(e){e._northEast,e._southWest;o.value=e._northEast.lat,s.value=e._northEast.lng,n.value=e._southWest.lat,r.value=e._southWest.lng,d.getZoom()},m=new L.Control.Draw(u);d.addControl(m),d.on("draw:created",function(e){e.layerType;var t=e.layer;c.addLayer(t),p(t._bounds)}),d.on("moveend",function(){bounds=this.getBounds(),p(bounds)}),e.addEventListener("click",function(e){e.preventDefault(),[document.querySelector("#diw-query-term"),document.querySelector("#diw-query-submit"),document.querySelector("#diw-as-toggle")].forEach(function(e){e.hasAttribute("disabled")?e.removeAttribute("disabled"):e.setAttribute("disabled","true")}),setTimeout(function(){d.invalidateSize()},1),bounds=d.getBounds(),p(bounds),t.classList.toggle("open")}),i.addEventListener("submit",function(e){e.preventDefault();var t=["?query=",document.querySelector("#geo-q").value?document.querySelector("#geo-q").value:"*:*","&max_x=",o.value,"&max_y=",s.value,"&min_x=",n.value,"&min_y=",r.value].join("");l.changeState(t)},!1)},l.objectify=function(e,t){var a;return"result"===t&&void 0===(a=e.result)&&(a=jQuery.parseJSON(e).result),void 0===t&&void 0===(a=e)&&(a=jQuery.parseJSON(e)),a},l.customQuery=function(e,t,a){var i=l.options.endPoint+l.endPointPath+"?"+e+"&format=json&rows="+t+"&diw-version="+l.version;l.ajaxRequest(i,function(e){var t=l.objectify(e,"result");a(t)})},l.getResults=function(t){var a,i;if(l.options.endPoint.length&&l.options.orgId.length||alert("You need to configure the Delving Instant with a valid endPoint and orgId"),e(l.options.layout.itemMediaBlock).empty(),e(l.options.layout.itemDataBlock).empty(),e(l.options.layout.itemRelatedBlock).empty(),a=t.replace(/\s&\s|\+&\+/g,"+%26+").replace(/\(/g,"%28").replace(/\)/g,"%29"),i=l.options.endPoint+l.endPointPath+"?"+a,l.customFacetFields&&void 0!==l.customFacetFields&&(i+=l.customFacetFields),l.dataProviders&&void 0!==l.dataProviders&&(i+=l.dataProviders),l.collectionSpecs&&void 0!==l.collectionSpecs&&(i+=l.collectionSpecs),l.searchIn&&void 0!==l.searchIn&&(i+=l.searchIn),l.apiEndPoint=i,"page"===l.options.pageId&&e.url(i).param("page")){var o=new RegExp("&page=\\d+");i=i.replace(o,"")}e.url(i).param(l.pageNrParameter)?i=i.toString().replace(l.pageNrParameter,"page"):i+="&page=1",!0===l.options.hasDigitalObject&&(i+="&hqf[]=delving_hasDigitalObject_facet:true");var s=(i+="&format=jsonp&facetBoolType=OR&lang="+l.options.language+"&rows="+l.options.rows+"&diw-version="+l.version).split("&").filter(function(e,t,a){return!e.startsWith("facet=")&&a.indexOf(e)===t});if(i=s.join("&"),l.options.configHelp){var n='<a href="'+i+'" rel="noopener" class="badge" title="Opens in new tab">Results JSON source</a>';e("#diw-config-feedback #resultsJson").html(n)}l.ajaxRequest(i,function(t){var a=l.objectify(t,"result");l.setStatus("DIW_GET_RESULTS"),a&&a.items.length>0?(l.showPagination(a),l.showSearchResults(a),!0===l.options.showFacets&&l.showFacets(a),l.magicLinks()):(e(l.options.layout.resultsBlock).empty(),e(l.options.layout.paginationBlock).empty(),e(l.options.layout.facetsBlock).empty(),e.tmpl("noResultTemplate",null).appendTo(l.options.layout.resultsBlock)),l.showBreadcrumbs(a),!0===l.options.showQueryInfo&&l.showQueryInfo(a);var o=a.items.map(function(e,t){return e.item.doc_id});if(VS_Store.set("diwItemNavTree",JSON.stringify(o)),VS_Store.set("diwItemNavResultsQuery",i),VS_Store.set("diwLastPage",a.pagination.lastPage),l.options.configHelp){var s='<h5>Available fields</h5> <pre><ul class="">';e.each(a.layout.layout,function(e,t){s+="<li>"+t.name+"</li>"}),s+="</ul></pre>",e("#diw-config-help #resultFields").html(s)}})},l.showQueryInfo=function(t){e.template("queryInfoTemplate",'<div class="nr-of-results">'+l.options.label.numberOfResults+' <span class="count">${numfound}</span></div>'),e(l.options.layout.queryInfoBlock).empty(),e.tmpl("queryInfoTemplate",t.query).appendTo(l.options.layout.queryInfoBlock),e(l.options.layout.queryInfoBlock+" a").each(function(){var t=e(this).text();e(this).text(t.replace(/.*:/g,""))}),l.showBreadcrumbs(t)},l.showBreadcrumbs=function(t){e.template("breadcrumbsTemplate",'<ul id="diw-query-crumbs" class="breadcrumb">{{each(i) breadCrumbs}}<li><a href="?${href}" class="diw-link">${value}</a></li>{{/each}}</ul>'),e(l.options.layout.breadcrumbsBlock).empty();var a=t.query;a.breadCrumbs.forEach(function(e){e.href=e.href.split("&").filter(function(e){return!e.startsWith("facet=")}).join("&")}),e.tmpl("breadcrumbsTemplate",a).appendTo(l.options.layout.breadcrumbsBlock),e(l.options.layout.breadcrumbsBlock+" a").each(function(){var t=e(this).text();e(this).text(t.replace(/.*:/g,""))})},l.showPagination=function(t){if(e.template("paginationTemplate",'<div class="pagination justify-content-between"><ul class="float-left"><li class="diw-page-prev{{if !hasPrevious}}disabled{{/if}}"><a href="?${fullQueryString}&'+l.pageNrParameter+'=${previousPageNumber}" class="diw-link prev">'+l.options.label.previous+'</a></li>{{each links}}<li class="diw-page {{if !isLinked}}active{{/if}}"><a href="?${fullQueryString}&'+l.pageNrParameter+'=${pageNumber}" class="diw-link {{if !isLinked}}current{{/if}}">${pageNumber}</a></li>{{/each}}<li class="diw-page-next {{if !hasNext}}disabled{{/if}}"><a href="?${fullQueryString}&'+l.pageNrParameter+'=${nextPageNumber}" class="diw-link next">'+l.options.label.next+" </a></li></ul></div>"),t.pagination.links.length>1){var a=t.query.breadCrumbs,i=a.length>1?a[a.length-1].href:"query="+t.query.terms;i=i.split("&").filter(function(e){return!e.startsWith("facet=")}).join("&"),e(l.options.layout.paginationBlock).html(e.tmpl("paginationTemplate",t.pagination,fullQueryString=i))}else e(l.options.layout.paginationBlock).empty();if(!0===l.options.resultsLayoutToggle){var o=e.cookie("diw-results-view")?e.cookie("diw-results-view"):l.options.resultsLayout,s='<ul class="view-switcher float-right"><li><a href="?${fullQueryString}" data-view="list" class="diw-view-switch list '+("list"===o?"active":"")+'">&nbsp;</a></li><li><a href="?${fullQueryString}" data-view="grid" class="diw-view-switch grid '+("grid"===o?"active":"")+'">&nbsp;</a></li></ul>';e(".diw-pagination:first").append(s),e(".diw-view-switch").on("click",function(t){t.preventDefault();var a=e(this).attr("data-view");e.cookie("diw-results-view",a),window.location.href=window.location.href})}},l.showSearchResults=function(t){var a="";a=null!==l.options.alternativeFieldLabelsPerSpecTrigger?l.options.alternativeFieldLabelsPerSpecTrigger:"europeana_collectionName";var i=l.options.resultsLayout;e.cookie("diw-results-view")&&(i=e.cookie("diw-results-view"),!0===l.options.resultsLayoutToggle&&(document.querySelector(".diw-view-switch").classList.remove("active"),document.querySelector(".diw-view-switch."+i).classList.add("active"))),"list"===i?(e.template("resultsListTemplate",'{{each(index) data}}<div class="media">{{if spec}}<input type="hidden" name="spec" value="${item.fields[spec]}"/>{{else}}{{if item.fields["europeana_collectionName"]}}<input type="hidden" name="spec" value="${item.fields["europeana_collectionName"]}"/>{{/if}}{{/if}}<a data-hubId="${item.fields.delving_hubId}" class="pull-left diw-link  diw-image-container" href="?'+l.options.itemId+'=${item.fields.delving_hubId}" title="'+l.options.label.goTo+' ${item.fields.delving_title}">{{if item.fields["'+l.options.thumbnailField+'"]}}<img  class="media-object diw-img" src="${item.fields.'+l.options.thumbnailField+'[0]}" alt="${item.fields.delving_title}" width="'+l.options.thumbnailWidth.replace("px","")+'" />{{else}}{{if item.fields.delving_thumbnail}}><img class="media-object diw-img" src="${item.fields.delving_thumbnail[0]}" alt="${item.fields.delving_title}" width="'+l.options.thumbnailWidth.replace("px","")+'"  />{{else}}<img class="media-object diw-img" src="'+l.options.defaultImg+'" alt="${item.fields.delving_title}" width="'+l.options.thumbnailWidth+'" />{{/if}}{{/if}}</a><div class="media-body">{{each(index, field) uFields}}{{if item.fields[field.name]}}{{if field.label}}<label for="${field.name}">${field.label}:</label> {{/if}}{{if field.name == "dc_title"}}<div class="diw-title media-heading"><a class="diw-link" data-hubId="${item.fields.delving_hubId}" href="?'+l.options.itemId+'=${item.fields.delving_hubId}" title="'+l.options.label.goTo+' ${item.fields.delving_title}"><span class="diw-data" name="${field.name}">${item.fields[field.name]}</span></a></div>{{else}}<span class="diw-data" name="${field.name}">{{html String(item.fields[field.name]).replace(/,/g,", ")}}</span><br/>{{/if}}{{/if}}{{/each}}</div></div>{{/each}}'),e(l.options.layout.resultsBlock).html(e.tmpl("resultsListTemplate",{data:t.items,uFields:l.options.resultFields,thumbnailField:l.options.thumbnailField,spec:a}))):(e.template("resultsGridTemplate",'<div class="diw-results-items row">{{each data}}<div class="diw-results-item '+l.options.resultsGridClasses+'"><a data-hubId="${item.fields.delving_hubId}" class="diw-link"  href="?'+l.options.itemId+'=${item.fields.delving_hubId}" class="diw-link diw-2item" title="'+l.options.label.goTo+' ${item.fields.delving_title}"><div class="diw-results-item-inner"><div class="diw-image-container">{{if item.fields.'+l.options.thumbnailField+'}}<img src="${item.fields.'+l.options.thumbnailField+'[0]}" width="'+l.options.thumbnailWidth.replace("px","")+'" class="diw-img" alt="${item.fields.delving_title}" />{{else}}{{if item.fields.delving_thumbnail}}<img src="${item.fields.delving_thumbnail[0]}" width="'+l.options.thumbnailWidth.replace("px","")+'" class="diw-img" alt="${item.fields.delving_title}" />{{else}}<img src="'+l.options.defaultImg+'" width="'+l.options.thumbnailWidth.replace("px","")+'" class="diw-img" alt="${item.fields.delving_title}" />{{/if}}{{/if}}</div><div class="caption">{{each(index, field) uFields}}{{if item.fields[field.name]}}{{if field.label}}<label for="${field.name}">${field.label}:</label> {{/if}}{{if field.name == "dc_title"}}<div class="diw-title media-heading"><span class="diw-data" name="${field.name}">${item.fields[field.name]}</span></div>{{else}}<span class="diw-data" name="${field.name}">{{html String(item.fields[field.name]).replace(/,/g,", ")}}</span><br/>{{/if}}{{/if}}{{/each}}</div></div></a></div>{{/each}}</div>'),e(l.options.layout.resultsBlock).html(e.tmpl("resultsGridTemplate",{data:t.items,uFields:l.options.resultFields,thumbnailField:l.options.thumbnailField,spec:a}))),setTimeout(function(){!0===l.options.resizeResultThumbnails&&e(".diw-image-container").imgLiquid({fill:!0,horizontalAlign:"center",verticalAlign:"top",useBackgroundSize:!1})},500),l.setStatus("DIW_SHOW_RESULTS"),l.options.alternativeFieldLabelsPerSpec&&l.options.alternativeFieldLabelsPerSpec.length&&e(".media").each(function(){var t=e(this).find('input[name="spec"]').attr("value");e.each(e(this).find("label"),function(a,i){e.each(l.options.alternativeFieldLabelsPerSpec,function(a,l){l.spec===t&&e.each(l.fields,function(t,a){e(i).attr("for")===a.name&&e(i).html(a.label)})})})}),e(".diw-title").each(function(){var t=e(this).text().trunc(l.options.maxCharactersTitle,!0);e(this).html(t)}),l.options.textExpander&&e(".diw-data").expander({slicePoint:l.options.maxCharactersResults,expandText:l.options.label.expand,userCollapseText:l.options.label.collapse}),e(".diw-img").on("error",function(){var e=jQuery(this);l.showDefaultImg(e)}),e(document).attr("title",l.options.label.searchResults+": "+t.query.terms+" - "+l.options.dataProviders),e(l.options.layout.resultsBlock).append('<div class="clearfix"><a style="color:#ccc;padding:2px 4px;font-size:11px;text-decoration: none" href="http://www.delving.eu" rel="noopener">Powered by Delving</a></div><br/>')},l.showFacets=function(t){e.template("facetTemplate",'{{if links.length > 0}}<div class="diw-facet-container" id="${name}"><div class="header">${label}</div><div class="inner">{{if '+l.options.sortFacets+"||"+l.options.explodeFacets+'}}<div class="facet-tools">{{if '+l.options.sortFacets+'}}<a href="#" class="sort sort-alpha" data-sort-type="name" data-id="${name}">'+l.options.label.sort+' A-Z</a><a href="#" class="sort sort-numeric" data-sort-type="count" data-id="${name}">'+l.options.label.sort+" 0-9</a>{{/if}}{{if "+l.options.explodeFacets+'}}<a href="#" class="explode" data-facet="${name}" data-label="${label}">'+l.options.label.expand+'</a>{{/if}}</div>{{/if}}<ul class="diw-facet-list">{{each links}}<li data-name="${displayString}" data-count="${count}"><div class="diw-facet-facet"><input type="checkbox" {{if isSelected }}checked="true"{{/if}} class="diw-link" data-href="?query=${qString}${url}"/><a href=\'?query=${qString}${url}\' class="diw-link facet-link {{if isSelected }}active{{/if}}">${displayString}</a></div></li>{{/each}}</ul></div></div>{{/if}}'),e.template("facetExplosion",'<div id="diw-exploded-facet-list" class="diw-facet-container"><button type="button" class="close" data-dismiss="diw-exploded-facet-list" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="facet-header"></div><div class="facet-tools">{{if '+l.options.sortFacets+'}}<a href="#" class="sort sort-alpha" data-sort-type="name" data-id="">'+l.options.label.sort+' A-Z</a><a href="#" class="sort sort-numeric" data-sort-type="count" data-id="">'+l.options.label.sort+' 0-9</a>{{/if}}<div class="facet-filter-form"><input type="text" id="facet-filter-input"/ placeholder="Filter"></div></div><div id="exploded-facet-list" class="inner"></div></div>'),e.template("listOnly",'<ul class="diw-facet-list" id="explosion-list">{{each links}}<li data-name="${displayString}" data-count="${count}"><div class="diw-facet-facet"><input type="checkbox" {{if isSelected }}checked="true"{{/if}} class="diw-link" data-href="?query=${qString}${url}"/><a href=\'?query=${qString}${url}\' class="diw-link facet-link {{if isSelected }}active{{/if}}">${displayString}</a></div></li>{{/each}}</ul>');var a="";l.options.configHelp&&(a="<h5>Available Facets</h5>",a+="<pre><ul>",e.each(t.facets,function(e,t){a+="<li>"+t.name+"</li>"}),a+="</ul></pre><hr/>",e("#diw-config-help #availableFacets").html(a));var i=[],o=function(){e(".diw-facet-container .diw-facet-list").each(function(t){$checked=e(this).find("input:checked"),$checked.length&&e(this).animate({scrollTop:$checked.offset().top-e(this).offset().top-50},1)})};if(e.isEmptyObject(l.options.displayFacets)?i=t.facets:(a="",e.each(l.options.displayFacets,function(o,s){var n=e.grep(t.facets,function(e,t){try{return e.name===s.name}catch(e){}})[0];try{i.push({label:s.label,name:n.name,isSelected:n.isSelected,links:n.links})}catch(t){if(l.options.configHelp)try{a+='<div class="error">'+s.name+" does not appear to be a facet</div>",e("#diw-config-help #errors").html(a)}catch(e){}}})),e(l.options.layout.facetsBlock).html(e.tmpl("facetTemplate",i,qString=t.query.terms)),!0===l.options.collapseFacets&&e(".diw-facet-container").length>0){var s=e(".diw-facet-container");e.each(s,function(){var t=e(this).find(".header"),a=e(this).find(".inner"),i=(e(this).find(".facet-tools"),e(this).find(".diw-facet-list").find("input:checked"));a.hide(),i.length>0&&(a.show(),t.addClass("open")),t.addClass("toggle").on("click",function(){t.toggleClass("open"),a.slideToggle("slow")})})}if(!0===l.options.explodeFacets){e(document.body).append(e.tmpl("facetExplosion"));var n=document.querySelectorAll(".facet-tools .explode"),r=document.querySelector("#diw-exploded-facet-list"),d=document.querySelector("#diw-exploded-facet-list .facet-header"),c=document.querySelectorAll("#diw-exploded-facet-list .sort"),u=document.querySelector("#exploded-facet-list");r.classList.remove("active"),u.innerHTML="",Array.prototype.forEach.call(n,function(a,s){a.addEventListener("click",function(s){s.preventDefault();var n=a.getAttribute("data-facet"),p=a.getAttribute("data-label");d.innerHTML=p,Array.prototype.forEach.call(c,function(e){e.setAttribute("data-id","exploded-facet-list")});!function(e,t,a){for(var i=0;i<e.length;i++)if(e[i][t]===a)return e[i]}(i,"name",n);var m=l.apiEndPoint+"&facet.full="+n.replace("_facet",".raw")+"&format=jsonp";l.ajaxRequest(m,function(a){if(a.result){var i=l.objectify(a,"result");if(e.tmpl("listOnly",i.facets,qString=t.query.terms).appendTo(u),document.querySelector("div#diw-exploded-facet-list button.close").addEventListener("click",function(){r.classList.remove("active")}),o(),l.magicLinks(),r.classList.contains("active"))u.innerHTML="",r.style.height="0px",r.addEventListener("transitionend",function(){r.classList.remove("active")},{once:!0});else{r.classList.add("active"),r.style.height="auto";var s=document.body.clientHeight+"px";r.style.height="0px",setTimeout(function(){r.style.height=s},0),!0===l.options.sortFacetsAlphaDefault&&sortFacets("exploded-facet-list","name"),o()}var n=document.getElementById("facet-filter-input");n.addEventListener("keyup",function(){var e=n.value.toUpperCase(),t=document.getElementById("explosion-list").querySelectorAll("li");for(let a=0;a<t.length;a++)t[a].getElementsByTagName("a")[0].innerHTML.toUpperCase().indexOf(e)>-1?t[a].style.display="":t[a].style.display="none"})}})})})}sortFacets=function(t,a){var i=e(".diw-facet-container").find("ul");t&&(i=e("#"+t).find("ul")),e.each(i,function(t,i){i=e(i);var l=e.makeArray(i.children("li"));i.hasClass("sorted")?(l.reverse(),i.empty(),e.each(l,function(e,t){i.append(t)}),i.removeClass("sorted")):(l.sort(function(t,i){var l=e(t).data(a),o=e(i).data(a);return/^[0-9]+$/.test(l)||(l=e(t).data(a).toLowerCase(),o=e(i).data(a).toLowerCase()),l<o?-1:l>o?1:0}),i.empty(),e.each(l,function(e,t){i.append(t)}),i.addClass("sorted"))}),l.magicLinks()},e(".diw-facet-container .sort").on("click",function(t){t.preventDefault();var a=e(this).data("id"),i=e(this).data("sort-type");sortFacets(a,i)}),!0===l.options.sortFacetsAlphaDefault&&sortFacets(null,"name"),o()},l.getItem=function(t){e(l.options.layout.facetsBlock).empty(),e(l.options.layout.resultsBlock).empty();var a=l.endPointPath.indexOf("/vc/")>-1?"/api/search/v1/":l.endPointPath,i=l.options.endPoint+a+"?"+t+"&format=jsonp&lang="+l.options.language+"&diw-version="+l.version;if(l.setStatus("DIW_GET_ITEM"),!0===l.options.showRelatedItems&&(i=i+"&mlt=true&mlt.count="+l.options.relatedItemsCount,l.options.collectionSpecs.forEach(function(e){i=i+"&mlt.filterkey=delving_spec:"+e})),""!==l.options.dataOwner&&(i=i+"&mlt.filterkey=edm_dataProvider:"+l.options.dataOwner),l.options.configHelp){var o='<a href="'+i.replace("format=jsonp","format=json")+'" class="badge" rel="noopener" title="Opens in new tab" target="_blank">Item JSON source</a>';e("#diw-config-help #itemJson").html(o)}l.ajaxRequest(i,function(a){var i=l.objectify(a,"result"),o=i.item.fields,s={},n=[],r=!1,d="",c="",u="";try{u=o.dc_identifier[0]}catch(e){u=o.dc_identifier}if(null!==l.options.alternativeFieldLabelsPerSpecTrigger)try{d=o[l.options.alternativeFieldLabelsPerSpecTrigger][0]}catch(e){d=o[l.options.alternativeFieldLabelsPerSpecTrigger]}else d=o.europeana_collectionName.join();if(i){if(e.each(l.options.itemImageFields,function(e,t){s[e.trim()]=o[t.trim()]}),l.options.configHelp)try{var p="<h5>Available Item Fields</h5>";p+="<pre><ul>",e.each(i.layout.fields.field,function(e,t){p+="<li>"+t.name+"</li>"}),p+="</ul></pre>",e("#diw-config-help #itemFields").html(p)}catch(e){}if(!0===l.options.showOriginalContextLink&&l.options.orignalContextField.length>0){var m=l.options.orignalContextField;o[m]&&(c=o[m])}var f="";o.delving_fullTextObjectUrl&&(f=o.delving_fullTextObjectUrl);var h="",v=[];o.delving_geohash&&"string"==typeof(h=o.delving_geohash[0])&&(v=h.split(","));var g=function(e){return e?"break"===e.trim()?"<br/>":"comma"===e.trim()?", ":"<br/>":"<br/>"};e.isEmptyObject(l.options.itemFields)?i.layout.layout.forEach(function(e,t){o[e.name]&&n.push({name:e.name,label:e.i18n,value:o[e.name],newQuery:void 0,externalLink:void 0,linkText:void 0,className:void 0,separator:void 0})}):l.options.itemFields.forEach(function(e,t){var a=[];if(e.fields)r=!0,e.fields.forEach(function(e,t){var i=null;e.externalLink&&(i=VS_Urls.isUrl(o[e.name])),o[e.name]&&a.push({label:e.label,name:e.name,value:o[e.name],newQuery:e.newQuery,newFacetQuery:e.newFacetQuery,externalLink:i,linkText:e.linkText,className:e.className,separator:g(e.separator)})}),a.length&&n.push({heading:e.label,id:e.id,fields:a});else if(o[e.name]){var i=null;e.externalLink&&(i=VS_Urls.isUrl(o[e.name])),n.push({label:e.label,name:e.name,value:o[e.name],newQuery:e.newQuery,newFacetQuery:e.newFacetQuery,externalLink:i,linkText:e.linkText,className:e.className,separator:g(e.separator)})}});var w=function(e){return/%[0-9a-f]{2}/i.test(e)?w(decodeURIComponent(e)):e};if(!0===l.options.showRelatedItems)try{var b,y,k=i.relatedItems.item.map(function(t){return y=l.options.thumbnailField,fields=[],b=jQuery.isArray(t.fields[y])?w(t.fields[y][0]):w(t.fields[y]),e.each(l.options.relatedItemsFields,function(e,a){t.fields[a.name]&&fields.push({key:a.name,label:a.label,value:t.fields[a.name][0]})}),"https:"===location.protocol&&b.startsWith("http:")&&(b=b.replace("http:","https:")),{hubId:t.fields.delving_hubId,thumbnail:b,fields:fields}});l.showRelatedItems(k,r)}catch(e){}l.showItem(n,s,d,c,u,f,v);var x=t.replace("id=","");l.showItemLevelNavigation(x),l.magicLinks()}else e.tmpl("noResultTemplate",null).appendTo(l.options.layout.resultsBlock)})},l.showItem=function(t,a,i,o,s,n,r){l.setStatus("DIW_SHOW_ITEM"),e.template("itemTemplate",'<div class="diw-results-item"><div class="bd"><div class="inner"><dl class="diw-field-list dl-horizontal">{{each data}}<dt><span class="diw-label" data-for="${name}">${label}</span></dt><dd class="diw-data" id="${name}">{{if newQuery && newQuery === true}}{{each(i, val) value}}<a href="?query=${val}" class="diw-link ${className}">${val}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{/each}}{{else newFacetQuery && newFacetQuery === true}}{{each(i, val) value}}<a href="?query=*:*&qf[]=${name}_facet:${val}" class="diw-link ${className}">${val}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{/each}}{{else externalLink === true}}{{each(j, val) value}}{{if linkText && linkText.trim().length}}<a rel="noopener" href="${val}" class="external ${className}">${linkText}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{else}}<a rel="noopener" href="${val}" class="external ${className}">${val}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{/if}}{{/each}}{{else}}{{if !(separator)}}<span class="${className}">{{html String(value).replace(/,/g,", ")}}</span>{{else}}{{each(k, val) value}}<span class="${className}">{{html String(val)}}</span>{{if separator && separator.length && (k+1 < value.length)}}{{html separator}}{{/if}}{{/each}}{{/if}}{{/if}}</dd>{{/each}}</dl></div></div></div>'),e.template("itemBlocksTemplate",'<div class="diw-results-item row"><div class="grid-sizer col-xs-12 col-sm-12 col-md-6 col-lg-4"></div>{{each data}}<div class="diw-block col-xs-12 col-sm-12 col-md-6 col-lg-4" id="block_${id}"><h3>${heading}</h3>{{each fields }}<div class="diw-field"><label class="diw-label" data-for="${name}">${label}</label><div class="diw-field-value">{{if newQuery && newQuery === true}}{{each(i, val) value}}<a href="?query=${val}" class="diw-link ${className}">${val}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{/each}}{{else newFacetQuery && newFacetQuery === true}}{{each(i, val) value}}<a href="?query=*:*&qf[]=${name}_facet:${val}" class="diw-link ${className}">${val}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{/each}}{{else externalLink === true}}{{each(j, val) value}}{{if linkText && linkText.trim().length}}<a rel="noopener" href="${val}" class="external ${className}">${linkText}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{else}}<a rel="noopener" href="${val}" class="external ${className}">${val}</a>{{if separator && separator.length && (i+1 < value.length)}}{{html separator}}{{/if}}{{/if}}{{/each}}{{else}}{{if !(separator)}}<span class="${className}">{{html String(value).replace(/,/g,", ")}}</span>{{else}}{{each(k, val) value}}<span class="${className}">{{html String(val)}}</span>{{if separator && separator.length && (k+1 < value.length)}}{{html separator}}{{/if}}{{/each}}{{/if}}{{/if}}</div></div>{{/each}}</div>{{/each}}</div>');for(var d=0;d<t.length;d++){if(t[d].fields){e(l.options.layout.itemDataBlock).html(e.tmpl("itemBlocksTemplate",{data:t}));var c=document.querySelector(".diw-results-item");new Masonry(c,{itemSelector:".diw-block",columnWidth:".grid-sizer",percentPosition:!0})}else e(l.options.layout.itemDataBlock).html(e.tmpl("itemTemplate",{data:t}));break}!0===l.options.useDeepZoom&&a.deepZoomUrl&&a.deepZoomUrl.length>0?l.showDeepZoom(a):l.showImageCarousel(a),n&&n.length>0&&l.pdfViewer(n),r&&r.length>0&&l.showGeoMap(r),e("html, body").animate({scrollTop:0},0),l.options.alternativeFieldLabelsPerSpec&&l.options.alternativeFieldLabelsPerSpec.length&&e("span.diw-label").each(function(t,a){e.each(l.options.alternativeFieldLabelsPerSpec,function(t,l){l.spec===i&&e.each(l.fields,function(t,i){e(a).data("for")===i.name&&e(a).html(i.label)})})}),l.options.textExpander&&e(".diw-data").expander({slicePoint:l.options.maxCharactersItem,expandText:l.options.label.expand,userCollapseText:l.options.label.collapse});var u={title:{label:"",value:""},creator:{label:"",value:""},id:{label:"",value:""},dataProvider:{label:"",value:""}};t.forEach(function(e,t){e.name&&("dc_title"===e.name&&(u.title.value=e.value[0]),"dc_creator"===e.name&&(u.creator.value=e.value),e.name===l.options.feedbackObjectField&&(u.id.value=e.value)),e.fields&&e.fields.forEach(function(e){"dc_title"===e.name&&(u.title.value=e.value[0]),"dc_creator"===e.name&&(u.creator.value=e.value),e.name===l.options.feedbackObjectField&&(u.id.value=e.value)})}),u.id.value||(u.id.value=s),e("#dl-image-0").length&&(l.lastImageViewed=e("#dl-image-0").attr("src").toString()),setTimeout(function(){l.osviewer?l.osviewer.addHandler("open",function(){l.lastImageViewed=e("#dl-image-"+l.osviewer.currentPage()).attr("src").toString()}):e("#diw-carousel").on("slide.bs.carousel",function(t){l.lastImageViewed=e("#dl-image-"+t.to).attr("src").toString()})},500);var p=u.title.value?u.title.value:"no title";if(e(document).attr("title",p+" - "+u.creator.value),e("#diw-query-crumbs").length){var m=document.querySelector("#diw-query-crumbs #title_crumb");m&&m.parentElement.removeChild(m),e("#diw-query-crumbs").append('<li id="title_crumb">'+p+"</li>")}if(null!==e.cookie("diw-return-uri")){var f=e.cookie("diw-return-uri");e(l.options.layout.paginationBlock).html('<a href="'+f+'" class="diw-b2results btn diw-button">'+l.options.label.returnToSearchResults+"</a>"),e(".diw-b2results").click(function(t){t.preventDefault(),e.cookie("diw-return-uri",null),l.changeState(f)})}!0===l.options.showOriginalContextLink&&l.options.orignalContextField.length>0&&o&&l.showOriginalContextLink(o),!0===l.options.downloadImage&&e("#dl-image-0").length&&l.showDownloadButton(),l.options.feedbackUserKey.trim().length>0&&l.showFeedbackForm(u,i),l.checkImages()},l.showItemLevelNavigation=function(t){var a='<div class="diw-item-nav"><ul><li><a href="#previous" class="btn diw-button item-nav item-nav-prev" data-direction="previous">&laquo;&laquo; '+l.options.label.previous+'</a></li><li><a href="#next" class="btn diw-button item-nav item-nav-next" data-direction="next">'+l.options.label.next+"&raquo;&raquo; </a></li></ul></div>";if(!VS_Store.get("diwItemNavTree").error){e(l.options.layout.paginationBlock).append(a);var i=JSON.parse(VS_Store.get("diwItemNavTree")),o=document.querySelectorAll(".item-nav"),s=i.indexOf(t)||0,n=VS_Urls.getParams("?"+VS_Store.get("diwItemNavResultsQuery")),r=n.page?n.page:1;1===parseInt(r)&&0===parseInt(s)&&e(".item-nav-prev").addClass("disabled"),parseInt(r)===parseInt(VS_Store.get("diwLastPage"))&&parseInt(s)===i.length-1&&e(".item-nav-next").addClass("disabled"),Array.prototype.forEach.call(o,function(t){t.addEventListener("click",function(a){a.preventDefault();var o=t.getAttribute("data-direction"),r=null;if(void 0!==(r="next"===o?i[Number(s)+1]:i[Number(s)-1]))l.changeState("?"+l.options.itemId+"="+r);else{var d,c,u="";u="next"===o?parseInt(n.page)+parseInt(1):parseInt(n.page)-parseInt(1);var p=new RegExp("&page=\\d+");d=sessionStorage.diwItemNavResultsQuery.replace(p,"&page="+u),c=l.options.endPoint+l.endPointPath+"?"+d;var m,f=new RegExp("&"+l.options.pageNrParameter+"=\\d+");m=e.cookie("diw-return-uri").indexOf(l.options.pageNrParameter)<0?e.cookie("diw-return-uri")+"&"+l.options.pageNrParameter+"="+u:e.cookie("diw-return-uri").replace(f,"&"+l.options.pageNrParameter+"="+u),e.cookie("diw-return-uri",m,{path:"/"}),l.ajaxRequest(c,function(e){var t=e.result.items.map(function(e,t){return e.item.doc_id});sessionStorage.setItem("diwItemNavTree",JSON.stringify(t)),sessionStorage.setItem("diwItemNavResultsQuery",d),r="next"===o?t[0]:t[Number(l.options.rows)-1],l.changeState("?"+l.options.itemId+"="+r)})}})})}},l.pdfViewer=function(t){e.template("itemPdfTemplate",'<div class="pdf-toolbar btn-toolbar" role="toolbar"><div class="btn-group" role="group"><button id="pdf-page-prev" class="btn btn-default diw-button mr-2">'+l.options.label.previous+'</button><button id="pdf-page-next" class="btn btn-default diw-button mr-2">'+l.options.label.next+'</button></div><div class="btn-group"><span class="btn btn-secondary" id="pdfPageNumberInput"><input type="number" id="pageNumber" title="Page" value="1" size="4" min="1" class="page-number" /> / <span id="page_count"></span></span></div><div class="btn-group"><select id="pdfZoomSelect" title="zoom" class="btn diw-button dropdown-toggle"><option value="0.50">50%</option><option value="1.1" selected>100%</option><option value="1.25">125%</option><option value="1.5">150%</option><option value="2.0">200%</option><option value="2.5">250%</option><option value="3.0">300%</option></select></div><div class="btn-group"><a href="'+t+'" download="'+t+'" class="btn diw-button" id="btn-download-pdf">&nbsp;</a></div><div class="btn-group"><img src="images/loader.svg" alt="" width="40" id="pdf-load-indicator"></div></div><div class="pdf-page-viewer"><canvas id="pdf-canvas"></canvas></div>'),e(l.options.layout.itemMediaBlock).html(e.tmpl("itemPdfTemplate"));var a="https://cors-anywhere.herokuapp.com/",i=t[0],o=1,s=!1,n=null,r=document.getElementById("pdf-canvas"),d=r.getContext("2d"),c=1.1;function u(e){s=!0,t.getPage(e).then(function(a){var i=a.getViewport(c);r.height=i.height,r.width=i.width;var l={canvasContext:d,viewport:i};a.render(l).promise.then(function(){s=!1,null!==n&&u(n)});var o=document.querySelector("#pdf-page-prev"),p=document.querySelector("#pdf-page-next");1===e?o.classList.add("disabled"):e===t.numPages?p.classList.add("disabled"):(o.classList.remove("disabled"),p.classList.remove("disabled"))}),document.getElementById("pageNumber").value=e}var p=pdfjsLib.getDocument({url:i}),m=document.querySelector("#pdf-load-indicator");function f(e){s?n=e:u(e)}p.onProgress=function(e){var t=e.loaded/e.total*100;parseInt(t,10)<100?m.style.display="block":m.style.display="none"},p.promise.then(function(e){t=e,document.getElementById("page_count").textContent=t.numPages,u(o)},function(e){m.style.display="none",console.error(e)}),document.getElementById("btn-download-pdf")&&document.getElementById("btn-download-pdf").addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("download"),i=a+t,l=new XMLHttpRequest;l.open("GET",i,!0),l.responseType="blob",l.onload=function(){var e=new Blob([l.response],{type:"application/pdf"});saveAs(e,t.substring(t.lastIndexOf("/")+1))},l.send()}),document.getElementById("pdf-page-prev").addEventListener("click",function(){o<=1||f(--o)}),document.getElementById("pdf-page-next").addEventListener("click",function(){o>=t.numPages||f(++o)}),document.getElementById("pageNumber").addEventListener("keyup",function(){if((o=Number(this.value))>t.numPages||o<Number(1)||!Number.isInteger(o))return!1;f(o)}),document.getElementById("pdfZoomSelect").addEventListener("change",function(){c=this.value,u(o)})},l.showImageCarousel=function(t){e.template("itemCarouselTemplate",'<div id="diw-carousel" class="carousel slide"  data-ride="carousel"><div class="carousel-inner">{{if data.image && data.image.length}}{{each(i, src) data.image}}<div class="carousel-item {{if i === 0}}active{{/if}}"><img src="${src}" style="max-width: 100%;" class="diw-img" id="dl-image-${i}"/></div>{{/each}}{{else data.imageAlt}}{{each(i, srcAlt) data.imageAlt}}<div class="item {{if i === 0}}active{{/if}}"><img src="${srcAlt}" style="max-width: 100%;" class="diw-img" id="dl-image-${i}"/></div>{{/each}}{{else}}<img src="'+l.options.defaultImg+'" style="max-width: 100%;" class="diw-img" />{{/if}}</div></div>{{if data.image && data.image.length > 1}}<a class="carousel-control-prev" href="#diw-carousel" role="button" data-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="carousel-control-next" href="#diw-carousel" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a>{{/if}}</div>{{if data.thumb && data.thumb.length > 1}}<div id="diw-thumbnail-nav" class="diw-carousel-nav">{{each(t, src) data.thumb}}<a href="#diw-carousel" class="diw-carousel-link {{if t == 0}}active{{/if}}" data-to="${t}"><img src="${src}" alt="thumb" class="diw-thumb-mini"/></a>{{/each}}</div>{{/if}}'),e(l.options.layout.itemMediaBlock).html(e.tmpl("itemCarouselTemplate",{data:t})),e("#diw-carousel").carousel({interval:!1});var a=document.querySelectorAll(".diw-carousel-link");e(".diw-carousel-nav a").on("click",function(t){t.preventDefault(),a.forEach(function(e){e.classList.remove("active")});var i=e(this).attr("data-to");e(".carousel").carousel(parseInt(i,10)),e(this).addClass("active")}),e("#diw-carousel").on("slide.bs.carousel",function(t){var a=t.to;e(".diw-carousel-link").removeClass("active");var i=e(".diw-carousel-link").get(a);e(i).addClass("active")})},l.showDeepZoom=function(t){e.template("itemZoomTemplate",'{{if data.deepZoomUrl}}{{each(d, url) data.deepZoomUrl}}<input type="hidden" name="diw-zoom-uri" value="${url}"/>{{/each}}<div class="diw-zoom-viewer"><div class="embed-responsive embed-responsive-16by9"><div class="embed-responsive-item" id="diw-zoom-viewer"></div></div></div>{{each(i, src) data.image}}<div class="hide print-image"><img src="${src}" id="dl-image-${i}"/></div>{{/each}}{{/if}}{{if data.thumb && data.thumb.length > 1}}<div id="diw-thumbnail-nav">{{each(t, src) data.thumb}}<a href="${data.deepZoomUrl[t]}" data-to="${t}" class="diw-zoom-link"><img src="${src}" alt="thumb" class="diw-thumb-mini"/></a>{{/each}}</div>{{/if}}'),e(l.options.layout.itemMediaBlock).html(e.tmpl("itemZoomTemplate",{data:t})),e("#diw-zoom-viewer").show();var a=e("input[name=diw-zoom-uri]").attr("value");l.osviewer=new OpenSeadragon.Viewer({id:"diw-zoom-viewer",prefixUrl:l.options.deepZoomControlImages,tileSources:t.deepZoomUrl,sequenceMode:!0,showNavigator:!0===l.options.deepZoomImageNavigator,showSequenceControl:!0===l.options.deepZoomSequenceButtons,showRotationControl:!0===l.options.deepZoomRotationControl,visibilityRatio:1,defaultZoomLevel:0,autoResize:!1,constrainDuringPan:!1,autoHideControls:!1}),l.osviewer.addHandler("error",function(){l.osviewer.close(),e("#diw-zoom-viewer, .diw-carousel-nav, .diw-original-context").css("display","none"),l.showImageCarousel(t)}),"https:"===location.protocol&&a.startsWith("http:")&&(a=a.replace("http:","https:")),l.osviewer.addHandler("open-failed",function(){e("#diw-zoom-viewer").html("<img src='"+l.options.defaultImg+"' class='img-fluid mx-auto d-block' style='width: 100%ff; height: 100%'/>")}),e(".diw-zoom-link").first().addClass("active"),e(".diw-zoom-link").on("click",function(t){t.preventDefault();var a=e(this);setThumbNavClassActive(a.index()),l.osviewer.goToPage(a.index())}),l.osviewer.nextButton&&l.osviewer.previousButton&&(l.osviewer.nextButton.addHandler("click",function(e){setThumbNavClassActive(l.osviewer.currentPage())}),l.osviewer.previousButton.addHandler("click",function(e){setThumbNavClassActive(l.osviewer.currentPage())})),setThumbNavClassActive=function(t){e(".diw-zoom-link").removeClass("active");var a=e(".diw-zoom-link").get(t);e(a).addClass("active")}},l.showOriginalContextLink=function(t){var a='<a href="'+t+'" rel="noopener" target="_blank" id="originalContextButton" class="btn diw-button float-right">'+l.options.label.viewInOriginalContext+"</a>";e(l.options.layout.paginationBlock+":first").append(a)},l.showGeoMap=function(e){var t=document.createElement("DIV");t.setAttribute("id","map-container");var a=document.createElement("SPAN");a.setAttribute("id","map-toggle"),a.setAttribute("class","expand"),t.appendChild(a),document.querySelector("#diw-item-media").appendChild(t);var i=parseFloat(e[0]),l=parseFloat(e[1]),o=L.tileLayer("https://a.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}),s=L.map("map-container",{layers:[o]});s.setView([i,l],12);L.marker([i,l]).addTo(s);a.addEventListener("click",function(e){t.classList.contains("full-size")?(t.classList.remove("full-size"),a.classList.add("expand"),a.classList.remove("collapse")):(t.classList.add("full-size"),a.classList.add("collapse"),a.classList.remove("expand")),setTimeout(function(){s.invalidateSize(),s.setView([i,l],12)},500)})},l.showDownloadButton=function(){var t='<button class="btn diw-button float-right" id="button-image-download">'+l.options.label.downloadImage+"</button>";e(l.options.layout.paginationBlock+":first".toString()).append(t),document.querySelector("button#button-image-download").addEventListener("click",function(e){e.preventDefault(),saveAs(l.lastImageViewed,"image.jpeg")})},l.showFeedbackForm=function(t,a){var i,o,s,n=0,r=0;i=t.title.value?t.title.value:"No title",o=t.id.value?t.id.value:"",s=t.creator.value?t.creator.value:"";var d='<a class="btn diw-button float-right" data-toggle="collapse" href="#diw-feedback-form" aria-expanded="false" aria-controls="diw-feedback-form" id="button-feedback-toggle">'+l.options.label.feedbackFormToggle+'</a><form class="collapse" id="diw-feedback-form" method="post"><div class="form-group"><label for="emailFrom">'+l.options.label.feedbackFormUserName+'</label><input type="text" name="nameFrom" id="nameFrom" class="form-control"/></div><div class="form-group"><label for="emailFrom">'+l.options.label.feedbackFormUserEmail+'</label><input type="email" name="emailFrom" id="emailFrom" class="form-control"/></div><div class="form-group"><label for="feedback">'+l.options.label.feedbackText+'</label><textarea name="feedback" id="feedback" class="form-control" rows="12"></textarea></div><button type="submit" class="btn diw-button" id="button-feedback-send">'+l.options.label.feedbackFormSubmit+'</button><input type="hidden" name="sourceURI" value="'+document.location.href+'"/><input type="hidden" name="collectionSpec" value="'+a+'"/><input type="hidden" name="recordID" value="'+o+'"/><input type="hidden" name="recordTitle" value="'+i+'"/><input type="hidden" name="recordCreator" value="'+s+'"/><input type="hidden" name="recordImageViewed" value=""/><div id="diw-feedback-status" class="alert mt-3"></div></form>';function c(t){e("#emailFrom").removeClass("is-invalid is-valid");/^(([^<>()\[\]\\.,;:\s@\"]+(\.[^<>()\[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?(n=1,e("#emailFrom").addClass("is-valid")):(n=0,e("#emailFrom").addClass("is-invalid"))}function u(t){e("#feedback").removeClass("is-invalid is-valid");/^(?=.*[A-Z0-9])[\r\n\w.,!?àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãñõÃÑÕäëïöüÿÄËÏÖÜŸçÇßØøÅåÆæœ@%&#\(\)*:;-_"'\/= ]+$/i.test(t)?(r=1,e("#feedback").addClass("is-valid")):(feedbacklValid=0,e("#feedback").addClass("is-invalid"))}function p(t){e("#nameFrom").removeClass("is-invalid is-valid");/^(?=.*[A-Z0-9])[\r\n\w.,!?àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãñõÃÑÕäëïöüÿÄËÏÖÜŸçÇßØøÅåÆæœ@%&#\(\)*:;-_"'\/= ]+$/i.test(t)?(nameValid=1,e("#nameFrom").addClass("is-valid")):(nameValid=0,e("#nameFrom").addClass("is-invalid"))}e(l.options.layout.paginationBlock+":first".toString()).append(d),e("#nameFrom").blur(function(){p(e(this).val())}),e("#emailFrom").blur(function(){c(e(this).val())}),e("#feedback").blur(function(){u(e(this).val())}),e("#diw-feedback-form").on("submit",function(t){e("#nameFrom, #emailFrom, #feedback").removeClass("is-invalid is-valid"),e("#diw-feedback-status").hide(),t.preventDefault();var a=e("#nameFrom").val(),i=e("#emailFrom").val(),o=e("#feedback").val();if(e("#diw-feedback-form input[name=recordImageViewed]").attr("value",l.lastImageViewed),p(a),c(i),u(o),n&&r){var s=e("#diw-feedback-form").serializeArray(),d={};e(s).each(function(e,t){d[t.name]=t.value}),d.requestID=l.options.feedbackUserKey,d.dryRun=!1;var m=JSON.stringify(d);e.ajax({url:"https://europe-west1-prod-hubs-delving-io.cloudfunctions.net/feedbackform",type:"POST",crossDomain:!0,data:m,success:function(t,a,i){e("#diw-feedback-status").addClass("alert-success").html(l.options.label.feedbackSuccess).show(),setTimeout(function(){e("#diw-feedback-form").collapse("hide")},3e3)},error:function(t,a,i){e("#diw-feedback-status").addClass("alert-danger").html(l.options.label.feedbackError).show()}})}})},l.showRelatedItems=function(t,a){e.template("relatedItemsBlockTemplate",'<div id="diw-related-items" class="diw-results-item diw-block"><h3>'+l.options.label.relatedItems+'</h3><div class="row">{{each data}}<div class="'+l.options.relatedItemsGridClasses+'"><a href="?'+l.options.itemId+'=${hubId}" class="diw-link diw-2item""><div class="diw-image-container"><img src="${thumbnail}" class="diw-img media-object" alt="${title}" width="'+l.options.thumbnailWidth.replace("px","")+'"/></div></a>{{if fields.length}}<ul class="related-item-fields">{{each(i, field) fields}}{{if field.key == "dc_title" || field.key == "delving_title"}}<li class="${field.key}"><a href="?'+l.options.itemId+'=${hubId}">${field.value}</a></li>{{else}}<li class="$diw-field {field.key}">{{if field.label}}<span class="field-label">{{/if}}${field.label}</span> <span class="field-value">${field.value}</span></li>{{/if}}{{/each}}</ul>{{/if}}</div>{{/each}}</div></div>'),e.template("relatedItemsListTemplate",'<div id="diw-related-items"><dl class="diw-field-list dl-related-items dl-horizontal"><dt><span class="diw-label">'+l.options.label.relatedItems+'</span></dt><dd class="diw-data-related"><div class="row">{{each data}}<div class="'+l.options.relatedItemsGridClasses+'"><a href="?'+l.options.itemId+'=${hubId}" class="diw-link diw-2item""><div class="diw-image-container"><img src="${thumbnail}" class="diw-img media-object" alt="${title}" width="'+l.options.thumbnailWidth.replace("px","")+'"/></div></a>{{if fields.length}}<ul class="related-item-fields">{{each(i, field) fields}}{{if field.key == "dc_title" || field.key == "delving_title"}}<li class="${field.key}"><a href="?'+l.options.itemId+'=${hubId}">${field.value}</a></li>{{else}}<li class="$diw-field {field.key}">{{if field.label}}<span class="field-label">{{/if}}${field.label}</span> <span class="field-value">${field.value}</span></li>{{/if}}{{/each}}</ul>{{/if}}</div>{{/each}}</div></dd></dl></div>');var i=a?"relatedItemsBlockTemplate":"relatedItemsListTemplate";e(l.options.layout.itemRelatedBlock).html(e.tmpl(i,{data:t})),setTimeout(function(){!0===l.options.resizeRelatedItemsThumbnails&&e(".diw-image-container").imgLiquid({fill:!0,horizontalAlign:"center",verticalAlign:"center",useBackgroundSize:!0})},500),l.checkImages()},l.init(),e.template("noResultTemplate",'<div class="diw-results-item"><span class="diw-no-results">'+l.options.label.noResults+"</span></div>"),History.Adapter.bind(window,"statechange",function(){e("body").removeClass("diw-init diw-search diw-search-results diw-detail");var t=e.url(),a=t.attr("query").replace(l.options.itemId,"id").replace("*%3A*","*:*");t.param("query")&&(window.scrollTo(0,0),l.getResults(a.replace(";")),e.cookie("diw-return-uri",t.attr("base")+t.attr("relative"),{path:"/"}),e("body").addClass("diw-search diw-search-results")),t.param(l.options.itemId)&&(e("body").addClass("diw-detail"),l.getItem(a)),a.length||(e("body").addClass("diw-init"),!0===l.options.searchOnPageInit&&(l.getResults("*:*"),setTimeout(function(){var e=document.createElement("a");e.href=window.location.href,e.search||(e.search="query=*:*"),l.changeState(e.toString())},250)))}),e(window).trigger("statechange")},e.DelvingInstant.defaultOptions={endPoint:"",endPointPath:"/api/search/v1/",orgId:"",dataProviders:[],collectionSpecs:[],dataOwner:"",searchIn:"",searchOnPageInit:!1,hasDigitalObject:!1,rows:"12",language:"en",resultsLayout:"list",resultsLayoutToggle:!0,gridGutterWidth:10,resultsGridClasses:"col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12",relatedItemsGridClasses:"col-xl-2 col-lg-3 col-md-4 col-sm-6 col-12",defaultImg:"images/placeholder.svg",queryParam:"query",itemId:"diw-id",pageId:"toto",pageNrParameter:"page",resizeResultThumbnails:!0,resizeRelatedItemsThumbnails:!0,downloadImage:!1,feedbackUserKey:"",feedbackObjectField:"dc_identifier",label:{advancedSearch:"Advanced search",advancedSearchClose:"Close advanced search",collapse:"Less&nbsp;[-]",expand:"More&nbsp;[+]",viewInOriginalContext:"View in original context",goTo:"Go to: ",next:"Next",noResults:":-( nothing found",downloadImage:"Download image",previous:"Previous",numberOfResults:"Number of results: ",returnToSearchResults:"Return to search-results",search:"Search",searchInputPlaceholder:"Search for...",searchResults:"Search-results",relatedItems:"Related items",sort:"sort",sortNumeric:"0-9",sortAlphabetic:"A-Z",feedbackFormToggle:"Feedback form",feedbackFormSubmit:"Submit",feedbackFormUserName:"Your name",feedbackFormUserEmail:"Your email adres",feedbackText:"Feedback",feedbackError:"Something went wrong",feedbackSuccess:"Feedback sent successfully"},layout:{simpleSearchBlock:"#diw-search",advancedSearchBlock:"#diw-advanced-search",paginationBlock:".diw-pagination",queryInfoBlock:"#diw-query-info",breadcrumbsBlock:"#diw-breadcrumbs",resultsBlock:"#diw-results",facetsBlock:"#diw-sidebar",relatedItemsBlock:"#diw-related",itemMediaBlock:"#diw-item-media",itemDataBlock:"#diw-item-data",itemRelatedBlock:"#diw-item-related"},showOriginalContextLink:!1,orignalContextField:"europeana_isShownAt",textExpander:!1,maxCharactersResults:"500",maxCharactersItem:"1200",maxCharactersTitle:"265",thumbnailField:"delving_thumbnail",thumbnailWidth:"200",resultFields:[],alternativeFieldLabelsPerSpecTrigger:null,resultFieldsAlternativeLabels:[],showFacets:!0,collapseFacets:!1,sortFacets:!1,sortFacetsAlphaDefault:!1,explodeFacets:!1,customFacets:[],displayFacets:[],itemFields:[],itemImageFields:{},relatedItemsFields:[],showQueryInfo:!0,useSimpleSearch:!0,useAdvancedSearch:!1,advancedSearchFields:[],useGeoSearch:!1,useDeepZoom:!1,deepZoomControlImages:"images/seadragon/",deepZoomSequenceButtons:!0,deepZoomImageNavigator:!1,configHelp:!1,showRelatedItems:!1,relatedItemsCount:6,usePushState:!0},e.fn.delvingInstant=function(t){return this.each(function(){new e.DelvingInstant(this,t)})},e.fn.getDelvingInstant=function(){this.data("DelvingInstant")}}(jQuery);